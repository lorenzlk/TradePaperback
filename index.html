<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>UPC Scanner</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading State -->
    <div id="loading" class="loading">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>Initializing camera...</p>
        </div>
    </div>

    <!-- Camera Permission Denied -->
    <div id="permission-denied" class="error-screen hidden">
        <div class="error-content">
            <div class="error-icon">üì∑</div>
            <h2>Camera Access Required</h2>
            <p>Please allow camera access to scan barcodes</p>
            <button onclick="location.reload()" class="retry-btn">Try Again</button>
        </div>
    </div>

    <!-- Main Scanner Interface -->
    <div id="scanner-container" class="scanner-container hidden">
        <!-- Video Element for Camera Feed -->
        <video id="video" playsinline autoplay></video>
        
        <!-- Scanning Overlay -->
        <div class="scanner-overlay">
            <!-- Scanning Frame -->
            <div class="scan-region">
                <div class="scan-frame">
                    <div class="corner corner-tl"></div>
                    <div class="corner corner-tr"></div>
                    <div class="corner corner-bl"></div>
                    <div class="corner corner-br"></div>
                </div>
                <div class="scan-line"></div>
            </div>
            
            <!-- Instructions -->
            <div class="instructions">
                <p id="instruction-text">Position barcode within frame</p>
                <div id="scanner-debug" class="scanner-debug"></div>
            </div>
        </div>

        <!-- Success Feedback -->
        <div id="success-feedback" class="success-feedback hidden">
            <div class="success-icon">‚úì</div>
            <div class="success-text">Scanned!</div>
        </div>

        <!-- Metadata Confirmation Card -->
        <div id="metadata-card" class="metadata-card hidden">
            <div class="metadata-header">
                <span class="metadata-title">üì¶ Scan Confirmed</span>
                <button id="metadata-close" class="metadata-close">‚úï</button>
            </div>
            <div class="metadata-body">
                <!-- Cover Image (shows when enriched data is available) -->
                <div id="metadata-cover-container" class="metadata-cover-container hidden">
                    <img id="metadata-cover-image" class="metadata-cover-image" alt="Cover" />
                    <div class="metadata-cover-loading">
                        <div class="spinner-small"></div>
                    </div>
                </div>
                
                <div class="metadata-row">
                    <span class="metadata-label">UPC:</span>
                    <span id="metadata-upc" class="metadata-value">-</span>
                </div>
                <div class="metadata-row">
                    <span class="metadata-label">Format:</span>
                    <span id="metadata-format" class="metadata-value">-</span>
                </div>
                <div class="metadata-row">
                    <span class="metadata-label">Time:</span>
                    <span id="metadata-time" class="metadata-value">-</span>
                </div>
                <div id="metadata-enriched" class="metadata-enriched hidden">
                    <div class="metadata-divider"></div>
                    <div class="metadata-row">
                        <span class="metadata-label">Title:</span>
                        <span id="metadata-title-value" class="metadata-value metadata-highlight">-</span>
                    </div>
                    <div class="metadata-row">
                        <span class="metadata-label">Publisher:</span>
                        <span id="metadata-publisher" class="metadata-value">-</span>
                    </div>
                    <div class="metadata-row">
                        <span class="metadata-label">Format:</span>
                        <span id="metadata-product-format" class="metadata-value">-</span>
                    </div>
                </div>
                <div class="metadata-status">
                    <span id="metadata-status-text">‚úì Saved to database</span>
                </div>
            </div>
        </div>

        <!-- Cover Scan Button -->
        <button id="cover-scan-btn" class="cover-scan-btn">üì∑ Scan Cover</button>

        <!-- Status Bar -->
        <div class="status-bar">
            <div id="status-text" class="status-text">Ready to scan</div>
            <button id="manual-entry-btn" class="manual-entry-btn">Can't scan? Enter manually</button>
        </div>
    </div>

    <!-- Manual Entry Modal -->
    <div id="manual-entry-modal" class="modal hidden">
        <div class="modal-content">
            <h2>Enter UPC Manually</h2>
            <p>Type the barcode number below:</p>
            <input type="text" id="manual-upc-input" placeholder="012345678905" maxlength="14" pattern="[0-9]*" inputmode="numeric">
            <div class="modal-buttons">
                <button id="manual-submit-btn" class="btn-primary">Submit</button>
                <button id="manual-cancel-btn" class="btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Error Message -->
    <div id="error-message" class="error-message hidden">
        <p id="error-text"></p>
    </div>

    <!-- Scripts -->
    <script>
        // Check if ZXing loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                const statusEl = document.getElementById('instruction-text');
                if (typeof ZXing === 'undefined') {
                    if (statusEl) statusEl.textContent = '‚ùå ZXing library failed to load!';
                    console.error('ZXing library not loaded');
                } else {
                    console.log('‚úÖ ZXing loaded:', ZXing);
                }
            }, 1000);
        });
    </script>
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    <script src="config.js"></script>
    <script src="scanner.js"></script>
</body>
</html>

